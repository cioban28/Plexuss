function notificationItemOnClick(n){mixpanel.track("Check_Notifications"),window.location=n}function bind_notify_button_toggle(){bind_notify_all_toggle(),bind_notify_msg_toggle(),bind_settings_btn_click()}function bind_notify_all_toggle(){var n=$(".notify_all_unique"),i=$("#notify_all_pane"),e=$(".top-nav-noti-pan-arrow.top-nav-all-noti-arrow"),t=$(".settings-topnav-menu-pane"),a=$(".top-nav-settings-arrow");n.bind("click",function(n){if(n.stopPropagation(),$.ajax({url:"/ajax/notifications/setRead",type:"GET",data:{type:"notify"},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}).done(function(){notificationHeartBeat()}),i.is(":visible"))i.slideUp(250,"easeInOutExpo"),e.css("visibility","hidden");else{var s=$(".notify_pane:visible"),o=$(".top-nav-noti-pan-arrow:visible");s.length?(s.slideUp(250,"easeInOutExpo",function(){i.slideDown(250,"easeInOutExpo")}),o.css("visibility","hidden"),e.css("visibility","visible")):(i.slideDown(250,"easeInOutExpo"),e.css("visibility","visible"))}t.hide(),a.css("visibility","hidden")})}function bind_notify_msg_toggle(){var n=$(".notify_msg_unique"),i=$("#notify_msg_pane"),e=$(".top-nav-noti-pan-arrow.top-nav-msg-noti-arrow"),t=$(".settings-topnav-menu-pane"),a=$(".top-nav-settings-arrow");n.click(function(n){if(n.stopPropagation(),$.ajax({url:"/ajax/notifications/setRead",type:"GET",data:{type:"msg"},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}).done(function(){newMessageAudio.setUnreadMessageCount(0),notificationHeartBeat()}),i.is(":visible"))i.slideUp(250,"easeInOutExpo"),e.css("visibility","hidden");else{var s=$(".notify_pane:visible"),o=$(".top-nav-noti-pan-arrow:visible");s.length?(s.slideUp(250,"easeInOutExpo",function(){i.slideDown(250,"easeInOutExpo")}),o.css("visibility","hidden"),e.css("visibility","visible")):(i.slideDown(250,"easeInOutExpo"),e.css("visibility","visible"))}t.hide(),a.css("visibility","hidden")})}function bind_settings_btn_click(){var n=$(".settings-menu-icon-section"),i=$(".settings-topnav-menu-pane"),e=$(".top-nav-settings-arrow"),t=$(".top-nav-noti-pan-arrow"),a=$("#notify_msg_pane"),s=$("#notify_all_pane");n.on("click",function(n){n.stopPropagation(),i.is(":visible")?(i.slideUp(250,"easeInOutExpo"),e.css("visibility","hidden")):(i.slideDown(250,"easeInOutExpo"),e.css("visibility","visible")),a.slideUp(250,"easeInOutExpo"),s.slideUp(250,"easeInOutExpo"),t.css("visibility","hidden")})}function notificationHeartBeat(){var n=$(".notify_all_unique .unread_count"),i=0;i=void 0==n?0:n.text();var e=$(".notify_msg_unique .unread_count"),t=e.text();void 0==t&&(t=0),setTimeout(function(){var a=window.OneSignal||[];a.push(function(){a.getUserId(function(a){var s=a;$.ajax({url:"/ajax/getTopNavNotification",type:"POST",data:{onsignal_user_id:s},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}).done(function(a){var s=a,o="",d=s.notification.unread_cnt,c=s.notification.data,l=$("#notify_all_pane .notify_pane_container");$.each(c,function(n,i){o+='<div class="row notify_page_notify_item" onclick=\'notificationItemOnClick("'+i.link+"\");' >",o+='<div class="small-1 columns '+i.img+'"></div>',o+='<div class="small-8 column notify_message">',o+='<span class="notify_title">'+i.name+"</span>",o+='<span class="notify_snippet">'+i.msg+"</span>",o+="</div>",o+='<div class="small-3 column text-right">',o+='<span class="notify_time">',o+=i.date,o+="</span>",o+="</div>",o+="</div>"}),0===d?(n.removeClass("active"),n.text(d),l.html(o),Tinycon.setBubble(d),localStorage.setItem("notificationcount",d)):d!==i&&(l.html(o),n.text(d),n.addClass("active"),Tinycon.setBubble(d),localStorage.setItem("notificationcount",d)),o="";var u=s.messages.unread_cnt,r=s.messages.data,p=$("#notify_msg_pane .notify_pane_container");$.each(r,function(n,i){o+='<div class="row notify_item" onclick=\'notificationItemOnClick("'+i.link+"\");' >",o+='<div class="small-2 column notify_image">',o+='<img src="'+i.img+'"/>',o+="</div>",o+='<div class="small-8 column">',o+='<div class="row">',o+='<div class="small-12 column notify_title">',o+="<span>",o+=i.Name,o+="</span>",o+="</div>",o+="</div>",o+='<div class="row">',o+='<div class="small-12 column notify_snippet">',o+="<span>",o+=i.msg,o+="</span>",o+="</div>",o+="</div>",o+="</div>",o+='<div class="small-2 column notify_date">',o+="<span>",o+=i.date,o+="</span>",o+="</div>",o+="</div>"}),0==u?(e.removeClass("active"),e.text(u),p.html(o)):u!=t&&(p.html(o),e.text(u),e.addClass("active")),$("messageTab.portalTab").hasClass("activeTab")&&$(".messingingWrapper").is(":visible")||newMessageAudio.hasUnreadCountChanged(),notificationHeartBeat()})})})},1e4)}newMessageAudio={current_unread_count:0,id:0},$(document).ready(function(){bind_notify_button_toggle();var n=parseInt($("#notify_msg .unread_count").text());n=isNaN(n)?0:n,newMessageAudio.setUnreadMessageCount(n)}),$(document).click(function(n){$("#notify_all_pane").css("display","none"),$("#notify_msg_pane").css("display","none"),$(".settings-topnav-menu-pane").css("display","none"),$(".top-nav-noti-pan-arrow").css("visibility","hidden"),$(".top-nav-settings-arrow").css("visibility","hidden")}),$(document).ready(function(){notificationHeartBeat()}),newMessageAudio.setUnreadMessageCount=function(n){newMessageAudio.current_unread_count=n},newMessageAudio.getUnreadMessagesCount=function(){return parseInt($("#notify_msg .unread_count").text())},newMessageAudio.hasUnreadCountChanged=function(){var n=newMessageAudio.getUnreadMessagesCount();n>newMessageAudio.current_unread_count&&(newMessageAudio.setUnreadMessageCount(n),newMessageAudio.makeNewMessageSound())},newMessageAudio.makeNewMessageSound=function(){var n=newMessageAudio.id,i='<iframe id="'+n+'" class="message-sound-clip" style="display: none;" width="0%" scrolling="no" frameborder="no" src="https://s3-us-west-2.amazonaws.com/asset.plexuss.com/college/sounds/pop_drip.wav"></iframe>';$("body").append(i),newMessageAudio.removeSoundElem(n),newMessageAudio.id++},newMessageAudio.removeSoundElem=function(n){setTimeout(function(){var i="iframe.message-sound-clip:not(#"+n+")";$("body").find(i).remove()},5e3)};var OneSignal=window.OneSignal||[];OneSignal.push(function(){OneSignal.on("notificationDismiss",function(n){var i=JSON.stringify(n.data.notification_id);$.ajax({url:"/ajax/updateTopNavNotification",type:"POST",data:{id:i},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}).done(function(n){})})}),OneSignal.push(["addListenerForNotificationOpened",function(n){var i=JSON.stringify(n.data.notification_id);$.ajax({url:"/ajax/updateTopNavNotification",type:"POST",data:{id:i},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}).done(function(n){})}]);