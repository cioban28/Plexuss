var Plex=Plex||{};Plex.lbox={id:0,owl:null,owlItemsToShow:4,lightbox:null,player:null};var Media=function(i){if(this.id=++Plex.lbox.id,!_.isEmpty(i))for(var t in i)i.hasOwnProperty(t)&&(this[t]=i[t])},MediaList=function(){this.list=[]};MediaList.prototype.add=function(){var i=Array.prototype.slice.call(arguments);this.list.push(i[0])},MediaList.prototype.remove=function(){var i=Array.prototype.slice.call(arguments);this.mediaList=_.reject(this.list,i[0])},MediaList.prototype.find=function(){var i=Array.prototype.slice.call(arguments),t={};return t[i[0]]=i[1],_.findWhere(this.list,t)},MediaList.prototype.count=function(){return this.list.length},MediaList.prototype.clear=function(){this.list.length=0};var Plex_Lightbox=function(){this.now_viewing=null,this.open=!1,this.media=new MediaList,this.view_others=this.init()};Plex_Lightbox.prototype.init=function(){var i,t=$(".is-lightboxable[data-link]"),e=this;this.media.clear(),$.each(t,function(){i=$(this),e.stripForData(i)}),this.renderViewOthers()},Plex_Lightbox.prototype.openMe=function(){$("#plex_lightbox").foundation("reveal","open"),$("#plex-lightbox-owl").show(),$("#plex-lightbox-owl").css("opacity",1)},Plex_Lightbox.prototype.closeMe=function(){$("#plex_lightbox").foundation("reveal","close"),$("#plex-lightbox-owl").css("opacity",0),$(".reveal-modal-bg").hide()},Plex_Lightbox.prototype.view=function(){var i=Array.prototype.slice.call(arguments),t=this.media.find("link",i[0]);t&&(this.now_viewing=t,this.renderNowViewing());var e=$(window).width(),o=$(window).height();e/o>2.8?$(".view-other-container").hide():$(".view-other-container").show()},Plex_Lightbox.prototype.renderNowViewing=function(){var i="";switch(this.now_viewing.type){case"image":i+='<div class="is-image">',i+='<img src="'+this.now_viewing.link+'" alt="" />',i+="</div>";break;case"video":i+='<div class="is-video" data-type="'+this.now_viewing.type+'" data-thumb="'+this.now_viewing.thumb+'" data-link="'+this.now_viewing.link+'">',i+='<iframe id="lbox_yt_player" src="'+this.now_viewing.link+'&autoplay=1&enablejsapi=1" frameborder="0" allowfullscreen width="100%" height="350px"></iframe>',i+="</div>"}$(".now-viewing-container").html(i),Plex.lbox.player=new YT.Player("lbox_yt_player"),this.openMe()},Plex_Lightbox.prototype.pauseVideo=function(){Plex.lbox.player.pauseVideo()},Plex_Lightbox.prototype.destroyVideo=function(){$("#plex_lightbox #lbox_yt_player").attr("src",""),$("iframe#lbox_yt_player").remove()},Plex_Lightbox.prototype.renderViewOthers=function(){var i="";_.each(this.media.list,function(t){i+='<div class="item">',i+='<img src="'+t.thumb+'" />',i+='<div class="play-layer is-lightboxable" data-type="'+t.type+'" data-thumb="'+t.thumb+'" data-link="'+t.link+'">',i+='<div class="play is-lightboxable">',i+='<div class="playbtn is-lightboxable"></div>',i+="</div>",i+="</div>",i+="</div>"}),$("#plex-lightbox-owl").html(i)},Plex_Lightbox.prototype.stripForData=function(){var i,t=Array.prototype.slice.call(arguments),e=null,o={};if(e=$(t[0]).data(),!_.isEmpty(e)){for(i in e)e.hasOwnProperty(i)&&(o[i]=e[i]);this.media.add(new Media(o))}};var lb_owl=$("#plex-lightbox-owl");Plex.lbox.lightbox=new Plex_Lightbox,Plex.lbox.owlItemsToShow=Plex.lbox.lightbox.media.count()>10?10:Plex.lbox.lightbox.media.count(),Plex.lbox.owlItemsToShow>=4?lb_owl.css({width:"100%"}):Plex.lbox.owlItemsToShow<3&&lb_owl.css({width:"50%"}),Plex.lbox.owl=lb_owl.owlCarousel({pagination:!1,navigation:!0,items:Plex.lbox.owlItemsToShow,beforeInit:function(i){i.html(""),0===i.children().length&&Plex.lbox.lightbox.init()}}),$(document).on("click",function(i){var t=$(i.target);t.hasClass("is-lightboxable")?t.closest(".is-lightboxable[data-link]").data("link")&&Plex.lbox.lightbox.view(t.closest(".is-lightboxable[data-link]").data("link")):$("#plex_lightbox  #lbox_yt_player").is(":visible")&&0===t.closest("#lbox_yt_player").length&&(Plex.lbox.lightbox.destroyVideo(),Plex.lbox.lightbox.closeMe())});