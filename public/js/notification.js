newMessageAudio={current_unread_count:0,id:0,};$(document).ready(function(){bind_notify_button_toggle();var initial_msg_count=parseInt($('#notify_msg .unread_count').text())
initial_msg_count=isNaN(initial_msg_count)?0:initial_msg_count;newMessageAudio.setUnreadMessageCount(initial_msg_count);});$(document).click(function(e){$('#notify_all_pane').css('display','none');$('#notify_msg_pane').css('display','none');$('.settings-topnav-menu-pane').css('display','none');$('.top-nav-noti-pan-arrow').css('visibility','hidden');$('.top-nav-settings-arrow').css('visibility','hidden');});function notificationItemOnClick(link){mixpanel.track("Check_Notifications");window.location=link;}
function bind_notify_button_toggle(){bind_notify_all_toggle();bind_notify_msg_toggle();bind_settings_btn_click();}
function bind_notify_all_toggle(){var button=$('.notify_all_unique');var panel=$('#notify_all_pane');var all_noti_arrow=$('.top-nav-noti-pan-arrow.top-nav-all-noti-arrow');var settings_container=$('.settings-topnav-menu-pane');var settings_arrow=$('.top-nav-settings-arrow');button.bind("click",function(e){e.stopPropagation();$.ajax({url:'/ajax/notifications/setRead',type:'GET',data:{type:'notify'},headers:{'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')},}).done(function(){notificationHeartBeat();});if(panel.is(':visible')){panel.slideUp(250,'easeInOutExpo');all_noti_arrow.css('visibility','hidden');}
else{var visible_panes=$('.notify_pane:visible');var visible_pane_arrow=$('.top-nav-noti-pan-arrow:visible');if(visible_panes.length){visible_panes.slideUp(250,'easeInOutExpo',function(){panel.slideDown(250,'easeInOutExpo');});visible_pane_arrow.css('visibility','hidden');all_noti_arrow.css('visibility','visible');}
else{panel.slideDown(250,'easeInOutExpo');all_noti_arrow.css('visibility','visible');}}
settings_container.hide();settings_arrow.css('visibility','hidden');});}
function bind_notify_msg_toggle(){var button=$('.notify_msg_unique');var panel=$('#notify_msg_pane');var msg_noti_arrow=$('.top-nav-noti-pan-arrow.top-nav-msg-noti-arrow');var settings_container=$('.settings-topnav-menu-pane');var settings_arrow=$('.top-nav-settings-arrow');button.click(function(e){e.stopPropagation();$.ajax({url:'/ajax/notifications/setRead',type:'GET',data:{type:'msg'},headers:{'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')},}).done(function(){newMessageAudio.setUnreadMessageCount(0);notificationHeartBeat();});if(panel.is(':visible')){panel.slideUp(250,'easeInOutExpo');msg_noti_arrow.css('visibility','hidden');}
else{var visible_panes=$('.notify_pane:visible');var visible_pane_arrow=$('.top-nav-noti-pan-arrow:visible');if(visible_panes.length){visible_panes.slideUp(250,'easeInOutExpo',function(){panel.slideDown(250,'easeInOutExpo');});visible_pane_arrow.css('visibility','hidden');msg_noti_arrow.css('visibility','visible');}
else{panel.slideDown(250,'easeInOutExpo');msg_noti_arrow.css('visibility','visible');}}
settings_container.hide();settings_arrow.css('visibility','hidden');});}
function bind_settings_btn_click(){var setting_btn=$('.settings-menu-icon-section');var settings_pane=$('.settings-topnav-menu-pane');var settings_arrow=$('.top-nav-settings-arrow');var all_topnav_noti_arrows=$('.top-nav-noti-pan-arrow');var msg_panel=$('#notify_msg_pane');var all_notifications_panel=$('#notify_all_pane');setting_btn.on('click',function(e){e.stopPropagation();if(settings_pane.is(':visible')){settings_pane.slideUp(250,'easeInOutExpo');settings_arrow.css('visibility','hidden');}else{settings_pane.slideDown(250,'easeInOutExpo');settings_arrow.css('visibility','visible');}
msg_panel.slideUp(250,'easeInOutExpo');all_notifications_panel.slideUp(250,'easeInOutExpo');all_topnav_noti_arrows.css('visibility','hidden');});}
$(document).ready(function(){notificationHeartBeat();});function notificationHeartBeat(){var notificationElem=$('.notify_all_unique .unread_count');var notificationCnt=0;if(notificationElem==undefined){notificationCnt=0;}else{notificationCnt=notificationElem.text();}
var messagesElem=$('.notify_msg_unique .unread_count');var messagesCnt=messagesElem.text();if(messagesCnt==undefined){messagesCnt=0;}
setTimeout(function(){var OneSignal=window.OneSignal||[];OneSignal.push(function(){OneSignal.getUserId(function(userId){var onsignal_user_id=userId;$.ajax({url:'/ajax/getTopNavNotification',type:'POST',data:{onsignal_user_id:onsignal_user_id},headers:{'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')},}).done(function(result){var parsed=result;var htmlData='';var jsonNotificationCnt=parsed.notification.unread_cnt;var jsonNotificationData=parsed.notification.data;var notificationContainer=$('#notify_all_pane .notify_pane_container');$.each(jsonNotificationData,function(index,val){htmlData+='<div class="row notify_page_notify_item" onclick='+"'notificationItemOnClick("+'"'+val.link+'");'+"' >";htmlData+='<div class="small-1 columns '+val.img+'"></div>'
htmlData+='<div class="small-8 column notify_message">';htmlData+='<span class="notify_title">'+val.name+'</span>';htmlData+='<span class="notify_snippet">'+val.msg+'</span>';htmlData+='</div>';htmlData+='<div class="small-3 column text-right">';htmlData+='<span class="notify_time">';htmlData+=val.date;htmlData+='</span>';htmlData+='</div>';htmlData+='</div>';});if(jsonNotificationCnt===0){notificationElem.removeClass('active');notificationElem.text(jsonNotificationCnt);notificationContainer.html(htmlData);Tinycon.setBubble(jsonNotificationCnt);localStorage.setItem("notificationcount",jsonNotificationCnt);}else if(jsonNotificationCnt!==notificationCnt){notificationContainer.html(htmlData);notificationElem.text(jsonNotificationCnt);notificationElem.addClass('active');Tinycon.setBubble(jsonNotificationCnt);localStorage.setItem("notificationcount",jsonNotificationCnt);}
htmlData='';var jsonmessagesCnt=parsed.messages.unread_cnt;var jsonmessagesData=parsed.messages.data;var messagesContainer=$('#notify_msg_pane .notify_pane_container');$.each(jsonmessagesData,function(index,val){htmlData+='<div class="row notify_item" onclick='+"'notificationItemOnClick("+'"'+val.link+'");'+"' >";htmlData+='<div class="small-2 column notify_image">';htmlData+='<img src="'+val.img+'"/>';htmlData+='</div>';htmlData+='<div class="small-8 column">';htmlData+='<div class="row">';htmlData+='<div class="small-12 column notify_title">';htmlData+='<span>';htmlData+=val.Name;htmlData+='</span>';htmlData+='</div>';htmlData+='</div>';htmlData+='<div class="row">';htmlData+='<div class="small-12 column notify_snippet">';htmlData+='<span>';htmlData+=val.msg;htmlData+='</span>';htmlData+='</div>';htmlData+='</div>';htmlData+='</div>';htmlData+='<div class="small-2 column notify_date">';htmlData+='<span>';htmlData+=val.date;htmlData+='</span>';htmlData+='</div>';htmlData+='</div>';});if(jsonmessagesCnt==0){messagesElem.removeClass('active');messagesElem.text(jsonmessagesCnt);messagesContainer.html(htmlData);}else if(jsonmessagesCnt!=messagesCnt){messagesContainer.html(htmlData);messagesElem.text(jsonmessagesCnt);messagesElem.addClass('active');}
if(!$('messageTab.portalTab').hasClass('activeTab')||!$('.messingingWrapper').is(':visible')){newMessageAudio.hasUnreadCountChanged();}
notificationHeartBeat();});});});},10000);}
newMessageAudio.setUnreadMessageCount=function(count){newMessageAudio.current_unread_count=count;}
newMessageAudio.getUnreadMessagesCount=function(){return parseInt($('#notify_msg .unread_count').text());}
newMessageAudio.hasUnreadCountChanged=function(){var curr_count=newMessageAudio.getUnreadMessagesCount();if(curr_count>newMessageAudio.current_unread_count){newMessageAudio.setUnreadMessageCount(curr_count);newMessageAudio.makeNewMessageSound();}}
newMessageAudio.makeNewMessageSound=function(){var sound_id=newMessageAudio.id;var audio_html='<iframe id="'+sound_id+'" class="message-sound-clip" style="display: none;" width="0%" scrolling="no" frameborder="no" src="https://s3-us-west-2.amazonaws.com/asset.plexuss.com/college/sounds/pop_drip.wav"></iframe>';$('body').append(audio_html);newMessageAudio.removeSoundElem(sound_id);newMessageAudio.id++;}
newMessageAudio.removeSoundElem=function(id){setTimeout(function(){var this_elem='iframe.message-sound-clip:not(#'+id+')';$('body').find(this_elem).remove();},5000);}
var OneSignal=window.OneSignal||[];OneSignal.push(function(){OneSignal.on('notificationDismiss',function(event){var id=JSON.stringify(event.data.notification_id);$.ajax({url:'/ajax/updateTopNavNotification',type:'POST',data:{id:id},headers:{'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')},}).done(function(result){});})});OneSignal.push(["addListenerForNotificationOpened",function(data){var id=JSON.stringify(data.data.notification_id);$.ajax({url:'/ajax/updateTopNavNotification',type:'POST',data:{id:id},headers:{'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')},}).done(function(result){});}]);